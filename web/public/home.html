<!doctype html>
<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="/logo.png" />
    <title>New API - Home</title>
    <meta name="description" content="New API 统一大模型接口网关首页" />

    <style>
      :root {
        --bg: #ffffff;
        --text-0: #0f172a;
        --text-1: #475569;
        --text-2: #64748b;
        --border: #e5e7eb;
        --fill: #f8fafc;
        --primary: #2563eb;
        --primary-contrast: #ffffff;
      }
      html.dark {
        --bg: #0b1020;
        --text-0: #e5e7eb;
        --text-1: #94a3b8;
        --text-2: #7c8aa5;
        --border: #1f2937;
        --fill: #0f152a;
        --primary: #60a5fa;
        --primary-contrast: #0b1020;
      }
      * { box-sizing: border-box; }
      html, body { margin: 0; padding: 0; height: 100%; }
      body {
        background: var(--bg);
        color: var(--text-0);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      }
      a { color: inherit; text-decoration: none; }
      .container { width: 100%; min-height: 100%; overflow-x: hidden; }

      /* Section / Hero */
      .section { border-bottom: 1px solid var(--border); position: relative; }
      .hero { min-height: 620px; display: flex; align-items: center; justify-content: center; padding: 96px 16px 120px; }
      .center { max-width: 1000px; width: 100%; margin: 0 auto; text-align: center; position: relative; z-index: 1; }
      h1 { margin: 0; font-weight: 800; line-height: 1.12; font-size: clamp(32px, 6vw, 64px); letter-spacing: 0.02em; }
      p.desc { margin: 16px auto 0; max-width: 720px; color: var(--text-1); font-size: clamp(14px, 2.6vw, 18px); }

      /* Shine text effect */
      .shine-text {
        background: linear-gradient(90deg, currentColor 0%, currentColor 40%, rgba(250, 204, 21, 0.9) 50%, currentColor 60%, currentColor 100%);
        background-size: 200% 100%;
        -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
        animation: sweep-shine 4s linear infinite;
      }
      @keyframes sweep-shine {
        0% { background-position: 200% 0; }
        100% { background-position: 0 0; }
      }

      /* Blurred balls */
      .blur-ball { position: absolute; width: 360px; height: 360px; border-radius: 50%; filter: blur(120px); pointer-events: none; z-index: 0; }
      .blur-ball-indigo { background: #6366f1; top: 40px; left: 50%; transform: translateX(-50%); opacity: .25; }
      .blur-ball-teal   { background: #14b8a6; top: 200px; left: 30%; opacity: .2; }
      html.dark .blur-ball-indigo { opacity: .5; }
      html.dark .blur-ball-teal { opacity: .4; }

      /* Input row */
      .input-row { max-width: 640px; margin: 20px auto 0; display: flex; gap: 10px; align-items: stretch; padding: 0 6px; }
      .input { flex: 1; display: flex; border: 1px solid var(--border); border-radius: 9999px; padding: 6px 10px; align-items: center; background: transparent; }
      .input input { flex: 1; background: transparent; border: none; outline: none; color: var(--text-0); font-size: 16px; padding: 10px; min-width: 0; }
      .suffix { display: flex; align-items: center; gap: 10px; padding-left: 8px; }
      .copy { width: 40px; height: 40px; border-radius: 9999px; border: 1px solid var(--border); background: var(--fill); display: inline-flex; align-items: center; justify-content: center; cursor: pointer; }
      .copy:hover { filter: brightness(0.98); }
      .copy svg { width: 18px; height: 18px; }

      /* ScrollList mimic */
      .scrolllist { height: 32px; overflow: hidden; display: flex; align-items: center; }
      .scrolllist-inner { transition: transform 420ms ease; will-change: transform; }
      .scrolllist-item { height: 32px; display: flex; align-items: center; padding: 0 2px; }
      .endpoint { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 14px; opacity: .9; white-space: nowrap; }

      /* Actions */
      .actions { display: flex; align-items: center; justify-content: center; gap: 12px; margin-top: 18px; flex-wrap: wrap; }
      .btn { border: 1px solid var(--border); background: var(--fill); color: var(--text-0); padding: 10px 18px; border-radius: 9999px; font-size: 16px; cursor: pointer; }
      .btn:hover { filter: brightness(0.98); }
      .btn.primary { background: var(--primary); color: var(--primary-contrast); border-color: transparent; }

      /* Support vendors */
      .support { margin-top: 64px; }
      .support h3 { margin: 0 0 16px; font-size: clamp(16px, 3vw, 20px); font-weight: 500; color: var(--text-1); }
      .vendors { display: flex; gap: 12px; align-items: center; justify-content: center; flex-wrap: wrap; opacity: .95; max-width: 1080px; margin: 0 auto; padding: 0 8px; }
      .vendor-chip { padding: 8px 12px; border: 1px solid var(--border); color: var(--text-2); border-radius: 12px; font-size: 14px; background: var(--fill); }

      /* Toast */
      .toast { position: fixed; top: 16px; left: 50%; transform: translateX(-50%); background: rgba(20,20,20,.9); color: #fff; padding: 10px 14px; border-radius: 10px; font-size: 14px; display: none; z-index: 1000; }
      html.dark .toast { background: rgba(250,250,250,.95); color: #111827; }

      /* Modal */
      .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.35); display: none; align-items: center; justify-content: center; padding: 20px; z-index: 999; }
      .modal { width: min(980px, 96%); max-height: 80vh; overflow: hidden; background: var(--bg); color: var(--text-0); border-radius: 14px; border: 1px solid var(--border); display: flex; flex-direction: column; }
      .modal header { padding: 10px 14px; border-bottom: 1px solid var(--border); font-weight: 600; display: flex; align-items: center; justify-content: space-between; gap: 12px; }
      .modal .body { padding: 0; }
      .modal footer { display: flex; gap: 10px; justify-content: flex-end; padding: 12px 14px; border-top: 1px solid var(--border); }
      .hidden { display: none !important; }

      /* Tabs */
      .tabs { display: inline-flex; gap: 6px; }
      .tab { border: 1px solid var(--border); background: var(--fill); color: var(--text-0); padding: 8px 10px; border-radius: 10px; font-size: 14px; cursor: pointer; display: inline-flex; gap: 6px; align-items: center; }
      .tab.active { background: var(--primary); color: var(--primary-contrast); border-color: transparent; }
      .tab svg { width: 14px; height: 14px; }

      /* Notice content scroll */
      .notice-scroll { padding: 16px; max-height: 55vh; overflow: auto; }

      /* Timeline */
      .timeline { padding: 16px; max-height: 55vh; overflow: auto; }
      .timeline-item { position: relative; padding-left: 24px; margin: 14px 0; }
      .timeline-item::before { content: ""; position: absolute; left: 8px; top: 6px; width: 8px; height: 8px; border-radius: 50%; background: var(--primary); }
      .timeline-time { font-size: 12px; color: var(--text-2); margin-bottom: 6px; }
      .timeline-content { font-size: 14px; }
      .timeline-extra { font-size: 12px; color: var(--text-2); margin-top: 6px; }

      /* Responsive */
      @media (max-width: 767px) {
        .hero { padding: 84px 12px 96px; min-height: 560px; }
        .input-row { margin-top: 16px; }
        .copy { width: 36px; height: 36px; }
      }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="section">
        <div class="blur-ball blur-ball-indigo"></div>
        <div class="blur-ball blur-ball-teal"></div>
        <div class="hero">
          <div class="center">
            <h1>
              <span id="title-line-1">统一的</span><br />
              <span class="shine-text" id="title-line-2">大模型接口网关</span>
            </h1>

            <p class="desc" id="desc-text">更好的价格，更好的稳定性，只需要将模型基址替换为：</p>

            <!-- Base URL + Endpoints Scroll + Copy -->
            <div class="input-row">
              <label class="input" aria-label="base-url">
                <input id="base-url" type="text" readonly value="" />
                <span class="suffix">
                  <div class="scrolllist" aria-hidden="true">
                    <div class="scrolllist-inner" id="endpoint-list"></div>
                  </div>
                  <button class="copy" id="copy-btn" title="Copy" aria-label="Copy base URL" type="button">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                      <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                    </svg>
                  </button>
                </span>
              </label>
            </div>

            <!-- Actions -->
            <div class="actions">
              <a class="btn primary" id="get-key" href="/console">获取密钥</a>
              <a class="btn hidden" id="doc-btn" target="_blank" rel="noreferrer">文档</a>
              <a class="btn hidden" id="github-btn" target="_blank" rel="noreferrer">GitHub</a>
            </div>

            <!-- Vendors -->
            <div class="support">
              <h3 id="support-text">支持众多的大模型供应商</h3>
              <div class="vendors" id="vendors">
                <span class="vendor-chip">OpenAI</span>
                <span class="vendor-chip">Claude</span>
                <span class="vendor-chip">Gemini</span>
                <span class="vendor-chip">Suno</span>
                <span class="vendor-chip">Qwen</span>
                <span class="vendor-chip">Grok</span>
                <span class="vendor-chip">Moonshot</span>
                <span class="vendor-chip">Minimax</span>
                <span class="vendor-chip">Wenxin</span>
                <span class="vendor-chip">Spark</span>
                <span class="vendor-chip">Qingyan</span>
                <span class="vendor-chip">Volcengine</span>
                <span class="vendor-chip">Cohere</span>
                <span class="vendor-chip">AzureAI</span>
                <span class="vendor-chip">Hunyuan</span>
                <span class="vendor-chip">Xinference</span>
                <span class="vendor-chip">Midjourney</span>
                <span class="vendor-chip">Zhipu</span>
                <span class="vendor-chip">30+</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Notice Modal -->
    <div class="modal-backdrop" id="notice-modal">
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="notice-title">
        <header>
          <div id="notice-title">系统公告</div>
          <div class="tabs" role="tablist">
            <button class="tab active" data-key="inApp" id="tab-inapp" role="tab" aria-selected="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8a6 6 0 0 1 0 8"></path><path d="M6 8a6 6 0 0 0 0 8"></path><path d="M2 12h20"></path></svg>
              <span id="tab-inapp-text">通知</span>
            </button>
            <button class="tab" data-key="system" id="tab-system" role="tab" aria-selected="false">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 5h-1a1 1 0 0 0-1 1v3H5l5-5Z"></path><path d="m14 12-4 4h6l4-4h-6Z"></path></svg>
              <span id="tab-system-text">系统公告</span>
            </button>
          </div>
        </header>
        <div class="body">
          <div class="notice-scroll" id="notice-content" role="tabpanel"></div>
          <div class="timeline hidden" id="announcement-timeline" role="tabpanel"></div>
        </div>
        <footer>
          <button class="btn" id="close-today">今日关闭</button>
          <button class="btn primary" id="close-notice">关闭公告</button>
        </footer>
      </div>
    </div>

    <script>
      (function () {
        // i18n dictionary
        const i18nDict = {
          zh: {
            title1: '统一的',
            title2: '大模型接口网关',
            desc: '更好的价格，更好的稳定性，只需要将模型基址替换为：',
            getKey: '获取密钥',
            docs: '文档',
            github: 'GitHub',
            copied: '已复制到剪切板',
            support: '支持众多的大模型供应商',
            notice: '系统公告',
            tabs: { inApp: '通知', system: '系统公告' },
            closeToday: '今日关闭',
            closeNotice: '关闭公告',
            copy: '复制',
            emptyNotice: '暂无公告',
            emptySystem: '暂无系统公告',
            justNow: '刚刚',
            minutesAgo: (m) => m + ' 分钟前',
            hoursAgo: (h) => h + ' 小时前',
            daysAgo: (d) => d + ' 天前',
          },
          en: {
            title1: 'The Unified',
            title2: 'LLMs API Gateway',
            desc: 'Better price, better stability. Just replace your base URL with:',
            getKey: 'Get API Key',
            docs: 'Docs',
            github: 'GitHub',
            copied: 'Copied to clipboard',
            support: 'Supports many AI model providers',
            notice: 'Announcements',
            tabs: { inApp: 'Notifications', system: 'System' },
            closeToday: 'Close today',
            closeNotice: 'Close',
            copy: 'Copy',
            emptyNotice: 'No announcements',
            emptySystem: 'No system announcements',
            justNow: 'Just now',
            minutesAgo: (m) => m + ' minutes ago',
            hoursAgo: (h) => h + ' hours ago',
            daysAgo: (d) => d + ' days ago',
          },
        };

        // Endpoints
        const endpoints = [
          '/v1/chat/completions',
          '/v1/responses',
          '/v1/messages',
          '/v1beta/models',
          '/v1/embeddings',
          '/v1/rerank',
          '/v1/images/generations',
          '/v1/images/edits',
          '/v1/images/variations',
          '/v1/audio/speech',
          '/v1/audio/transcriptions',
          '/v1/audio/translations',
        ];

        // Elements
        const $ = (id) => document.getElementById(id);
        const baseUrlInput = $('base-url');
        const copyBtn = $('copy-btn');
        const getKeyBtn = $('get-key');
        const docBtn = $('doc-btn');
        const githubBtn = $('github-btn');
        const toast = $('toast');
        const noticeModal = $('notice-modal');
        const noticeContent = $('notice-content');
        const timeline = $('announcement-timeline');
        const closeTodayBtn = $('close-today');
        const closeNoticeBtn = $('close-notice');
        const noticeTitle = $('notice-title');
        const tabInApp = $('tab-inapp');
        const tabSystem = $('tab-system');
        const tabInAppText = $('tab-inapp-text');
        const tabSystemText = $('tab-system-text');
        const endpointList = $('endpoint-list');

        // State
        let lang = (localStorage.getItem('i18nextLng') || 'zh').startsWith('zh') ? 'zh' : 'en';
        let themeMode = (localStorage.getItem('theme-mode') || 'auto');
        let endpointIndex = 0;
        let serverAddress = window.location.origin;
        let announcements = [];
        let activeTab = 'inApp';
        let itemHeight = 32; // default; measured after render

        // Helpers
        function applyTheme(mode) {
          const actual = mode === 'auto'
            ? (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
            : mode;
          document.documentElement.classList.toggle('dark', actual === 'dark');
        }

        function dict() { return i18nDict[lang] || i18nDict.zh; }

        function i18nRender() {
          $('title-line-1').textContent = dict().title1;
          $('title-line-2').textContent = dict().title2;
          $('desc-text').textContent = dict().desc;
          getKeyBtn.textContent = dict().getKey;
          docBtn.textContent = dict().docs;
          $('support-text').textContent = dict().support;
          noticeTitle.textContent = dict().notice;
          tabInAppText.textContent = dict().tabs.inApp;
          tabSystemText.textContent = dict().tabs.system;
          closeTodayBtn.textContent = dict().closeToday;
          closeNoticeBtn.textContent = dict().closeNotice;
          document.title = 'New API - ' + (lang === 'zh' ? '首页' : 'Home');
        }

        function showToast(msg) {
          toast.textContent = msg;
          toast.style.display = 'block';
          setTimeout(() => (toast.style.display = 'none'), 1600);
        }

        function renderEndpoints() {
          endpointList.innerHTML = endpoints.map(e => '<div class="scrolllist-item"><span class="endpoint">' + e + '</span></div>').join('');
          requestAnimationFrame(() => {
            const firstItem = endpointList.querySelector('.scrolllist-item');
            if (firstItem) itemHeight = Math.round(firstItem.getBoundingClientRect().height);
          });
        }

        function rotateEndpoint() {
          endpointIndex = (endpointIndex + 1) % endpoints.length;
          endpointList.style.transform = 'translateY(' + (-endpointIndex * itemHeight) + 'px)';
        }

        function setServerAddress(value) {
          serverAddress = value || window.location.origin;
          baseUrlInput.value = serverAddress;
        }

        function relativeTime(publishDate) {
          if (!publishDate) return '';
          const now = new Date();
          const date = new Date(publishDate);
          if (isNaN(date.getTime())) return String(publishDate);
          const diff = (now - date) / 1000; // seconds
          if (diff < 60) return dict().justNow;
          if (diff < 3600) return dict().minutesAgo(Math.floor(diff / 60));
          if (diff < 86400) return dict().hoursAgo(Math.floor(diff / 3600));
          return dict().daysAgo(Math.floor(diff / 86400));
        }

        // Copy handler
        copyBtn.addEventListener('click', async function () {
          try {
            await navigator.clipboard.writeText(serverAddress);
            showToast(dict().copied);
          } catch (e) {
            try {
              const ta = document.createElement('textarea');
              ta.value = serverAddress;
              ta.setAttribute('readonly', '');
              ta.style.position = 'fixed';
              ta.style.left = '-9999px';
              ta.style.top = '-9999px';
              document.body.appendChild(ta);
              ta.select();
              document.execCommand('copy');
              document.body.removeChild(ta);
              showToast(dict().copied);
            } catch (err) { console.error(err); }
          }
        });

        // Notice modal controls
        function openNoticeModal() { noticeModal.style.display = 'flex'; }
        function closeNotice(saveToday) {
          if (saveToday) localStorage.setItem('notice_close_date', new Date().toDateString());
          noticeModal.style.display = 'none';
        }
        closeTodayBtn.addEventListener('click', () => closeNotice(true));
        closeNoticeBtn.addEventListener('click', () => closeNotice(false));

        function setActiveTab(key) {
          activeTab = key;
          if (key === 'inApp') {
            tabInApp.classList.add('active');
            tabSystem.classList.remove('active');
            noticeContent.classList.remove('hidden');
            timeline.classList.add('hidden');
          } else {
            tabSystem.classList.add('active');
            tabInApp.classList.remove('active');
            timeline.classList.remove('hidden');
            noticeContent.classList.add('hidden');
          }
        }
        tabInApp.addEventListener('click', () => setActiveTab('inApp'));
        tabSystem.addEventListener('click', () => setActiveTab('system'));

        // Data loaders
        function initStatus() {
          return fetch('/api/status', { cache: 'no-store' })
            .then((r) => r.json())
            .then((res) => {
              if (res && res.success) {
                const data = res.data || {};
                const addr = data.server_address || window.location.origin;
                setServerAddress(addr);

                // Version / Docs button logic
                if (data.demo_site_enabled && data.version) {
                  githubBtn.classList.remove('hidden');
                  githubBtn.textContent = data.version;
                  githubBtn.href = 'https://github.com/QuantumNous/new-api';
                } else if (data.docs_link) {
                  docBtn.classList.remove('hidden');
                  docBtn.href = data.docs_link;
                }

                // Announcements for system tab
                announcements = Array.isArray(data.announcements) ? data.announcements.slice(0, 20) : [];
                renderAnnouncements();
              } else {
                setServerAddress(window.location.origin);
              }
            })
            .catch(() => setServerAddress(window.location.origin));
        }

        function initNotice() {
          const lastCloseDate = localStorage.getItem('notice_close_date');
          const today = new Date().toDateString();
          if (lastCloseDate === today) return;

          fetch('/api/notice', { cache: 'no-store' })
            .then((r) => r.json())
            .then((res) => {
              if (res && res.success) {
                const data = res.data;
                if (data && String(data).trim() !== '') {
                  const html = (window.marked ? window.marked.parse(data) : data);
                  noticeContent.innerHTML = html;
                  setActiveTab('inApp');
                  openNoticeModal();
                } else {
                  noticeContent.innerHTML = '<div style="padding:16px; color: var(--text-2);">' + dict().emptyNotice + '</div>';
                }
              }
            })
            .catch(() => {});
        }

        function renderAnnouncements() {
          if (!announcements || announcements.length === 0) {
            timeline.innerHTML = '<div style="color: var(--text-2);">' + dict().emptySystem + '</div>';
            return;
          }
          timeline.innerHTML = announcements.map((item) => {
            const pub = item && item.publishDate ? new Date(item.publishDate) : null;
            const timeAbs = pub && !isNaN(pub.getTime())
              ? pub.getFullYear() + '-' + String(pub.getMonth()+1).padStart(2,'0') + '-' + String(pub.getDate()).padStart(2,'0') + ' ' + String(pub.getHours()).padStart(2,'0') + ':' + String(pub.getMinutes()).padStart(2,'0')
              : (item && item.publishDate) || '';
            const rel = relativeTime(item && item.publishDate);
            const contentHtml = (window.marked ? window.marked.parse(item && item.content || '') : (item && item.content || ''));
            const extraHtml = item && item.extra ? (window.marked ? window.marked.parse(item.extra) : item.extra) : '';
            return (
              '<div class="timeline-item">' +
                '<div class="timeline-time">' + (rel ? rel + ' ' : '') + timeAbs + '</div>' +
                '<div class="timeline-content">' + contentHtml + '</div>' +
                (extraHtml ? '<div class="timeline-extra">' + extraHtml + '</div>' : '') +
              '</div>'
            );
          }).join('');
        }

        // Messages from parent (theme, lang, serverAddress)
        window.addEventListener('message', (event) => {
          const data = event.data || {};
          if (data.themeMode) {
            themeMode = data.themeMode;
            applyTheme(themeMode);
          }
          if (data.lang) {
            lang = (String(data.lang).startsWith('zh') ? 'zh' : 'en');
            i18nRender();
          }
          if (data.serverAddress) {
            setServerAddress(data.serverAddress);
          }
        });

        // Init
        applyTheme(themeMode);
        i18nRender();
        setServerAddress(window.location.origin);
        renderEndpoints();
        initStatus().then(() => initNotice());
        setActiveTab('inApp');

        // rotate endpoints
        setInterval(rotateEndpoint, 3000);

        // keep item height on resize
        window.addEventListener('resize', () => {
          const firstItem = endpointList.querySelector('.scrolllist-item');
          if (firstItem) itemHeight = Math.round(firstItem.getBoundingClientRect().height);
          endpointList.style.transform = 'translateY(' + (-endpointIndex * itemHeight) + 'px)';
        });
      })();
    </script>
  </body>
</html>
